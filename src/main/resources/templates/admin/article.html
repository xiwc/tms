<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring4-4.dtd">
<html lang="zh-cn" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <base th:href="@{/}" href="">
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="file-upload-url" th:content="@{/admin/article/upload}">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <title>立衡脊柱-文章管理</title>
    <link rel="stylesheet" type="text/css" th:href="@{/lib/semantic/semantic.min.css}" href="../../static/lib/semantic/semantic.min.css" />
    <link rel="stylesheet" th:href="@{/lib/awesome/css/font-awesome.css}" href="../../static/lib/awesome/css/font-awesome.css" />
    <link rel="stylesheet" th:href="@{/lib/wysiwyg/wysiwyg-editor.css}" href="../../static/lib/wysiwyg/wysiwyg-editor.css" />
    <link rel="stylesheet" th:href="@{/lib/toastr/toastr.css}" href="../../static/lib/toastr/toastr.css" />
    <link rel="stylesheet" type="text/css" th:href="@{/admin/css/md-github.css}" href="../../static/admin/css/md-github.css" />
    <!-- 自定义css -->
    <link rel="stylesheet" type="text/css" th:href="@{/admin/css/admin.css}" href="../../static/admin/css/admin.css" />
    <script type="text/javascript" th:src="@{/lib/jquery-1.11.2.min.js}" src="../../static/lib/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" th:src="@{/lib/semantic/semantic.min.js}" src="../../static/lib/semantic/semantic.min.js"></script>
    <script type="text/javascript" th:src="@{/lib/wysiwyg/wysiwyg-editor.min.js}" src="../../static/lib/wysiwyg/wysiwyg-editor.min.js"></script>
    <script type="text/javascript" th:src="@{/lib/jquery.iframe-transport.js}" src="../../static/lib/jquery.iframe-transport.js"></script>
    <script th:src="@{/lib/toastr/toastr.js}" src="../../static/lib/toastr/toastr.js"></script>
    <script type="text/javascript" th:src="@{/lib/showdown.min.js}" src="../../static/lib/showdown.min.js"></script>
    <!-- 自定义js -->
    <script type="text/javascript" th:src="@{/admin/js/admin.js}" src="../../static/admin/js/admin.js"></script>
</head>

<body>
    <div th:replace="admin/index :: sidebar-menu"></div>
    <div th:replace="admin/index :: top-fixed-menu"></div>
    <div class="pusher ad-index-content">
        <div class="ad-index-container">
            <div th:replace="admin/index :: rail-menu"></div>
            <div id="context">
                <div th:replace="admin/template :: ad-page-header ('文章管理', 'article')"></div>
                <div class="ui attached segment">
                    <div class="ui left icon input">
                        <input id="inputFileName" type="text" placeholder="文章标题">
                        <i class="file icon"></i>
                    </div>
                    <div id="btnSave" class="ui primary button">保存</div>
                    <a class="ui primary button" th:href="@{/admin/article/page/list}" href="article-list.html">全部文章</a>
                </div>
                <div class="ui attached segment lhjz-article-editor">
                    <textarea id="lhjz-textarea-wysiwyg" style="width: 100%; height: 200px;"></textarea>
                </div>
            </div>
        </div>
    </div>
    <!-- 隐藏的图标元素 -->
    <div class="lhjz-editor-smiles">
        <img src="../../static/lib/wysiwyg/smiley/afraid.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/afraid.png}"><img src="../../static/lib/wysiwyg/smiley/amorous.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/amorous.png}"><img src="../../static/lib/wysiwyg/smiley/angel.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/angel.png}"><img src="../../static/lib/wysiwyg/smiley/angry.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/angry.png}"><img src="../../static/lib/wysiwyg/smiley/bored.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/bored.png}"><img src="../../static/lib/wysiwyg/smiley/cold.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/cold.png}"><img src="../../static/lib/wysiwyg/smiley/confused.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/confused.png}"><img src="../../static/lib/wysiwyg/smiley/cross.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/cross.png}"><img src="../../static/lib/wysiwyg/smiley/crying.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/crying.png}"><img src="../../static/lib/wysiwyg/smiley/devil.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/devil.png}"><img src="../../static/lib/wysiwyg/smiley/disappointed.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/disappointed.png}"><img src="../../static/lib/wysiwyg/smiley/dont-know.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/dont-know.png}"><img src="../../static/lib/wysiwyg/smiley/drool.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/drool.png}"><img src="../../static/lib/wysiwyg/smiley/embarrassed.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/embarrassed.png}"><img src="../../static/lib/wysiwyg/smiley/excited.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/excited.png}"><img src="../../static/lib/wysiwyg/smiley/excruciating.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/excruciating.png}"><img src="../../static/lib/wysiwyg/smiley/eyeroll.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/eyeroll.png}"><img src="../../static/lib/wysiwyg/smiley/happy.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/happy.png}"><img src="../../static/lib/wysiwyg/smiley/hot.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/hot.png}"><img src="../../static/lib/wysiwyg/smiley/hug-left.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/hug-left.png}"><img src="../../static/lib/wysiwyg/smiley/hug-right.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/hug-right.png}"><img src="../../static/lib/wysiwyg/smiley/hungry.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/hungry.png}"><img src="../../static/lib/wysiwyg/smiley/invincible.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/invincible.png}"><img src="../../static/lib/wysiwyg/smiley/kiss.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/kiss.png}"><img src="../../static/lib/wysiwyg/smiley/lying.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/lying.png}"><img src="../../static/lib/wysiwyg/smiley/meeting.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/meeting.png}"><img src="../../static/lib/wysiwyg/smiley/nerdy.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/nerdy.png}"><img src="../../static/lib/wysiwyg/smiley/neutral.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/neutral.png}"><img src="../../static/lib/wysiwyg/smiley/party.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/party.png}"><img src="../../static/lib/wysiwyg/smiley/pirate.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/pirate.png}"><img src="../../static/lib/wysiwyg/smiley/pissed-off.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/pissed-off.png}"><img src="../../static/lib/wysiwyg/smiley/question.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/question.png}"><img src="../../static/lib/wysiwyg/smiley/sad.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/sad.png}"><img src="../../static/lib/wysiwyg/smiley/shame.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/shame.png}"><img src="../../static/lib/wysiwyg/smiley/shocked.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/shocked.png}"><img src="../../static/lib/wysiwyg/smiley/shut-mouth.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/shut-mouth.png}"><img src="../../static/lib/wysiwyg/smiley/sick.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/sick.png}"><img src="../../static/lib/wysiwyg/smiley/silent.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/silent.png}"><img src="../../static/lib/wysiwyg/smiley/sleeping.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/sleeping.png}"><img src="../../static/lib/wysiwyg/smiley/sleepy.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/sleepy.png}"><img src="../../static/lib/wysiwyg/smiley/stressed.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/stressed.png}"><img src="../../static/lib/wysiwyg/smiley/thinking.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/thinking.png}"><img src="../../static/lib/wysiwyg/smiley/tongue.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/tongue.png}"><img src="../../static/lib/wysiwyg/smiley/uhm-yeah.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/uhm-yeah.png}"><img src="../../static/lib/wysiwyg/smiley/wink.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/wink.png}"><img src="../../static/lib/wysiwyg/smiley/working.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/working.png}"><img src="../../static/lib/wysiwyg/smiley/bathing.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/bathing.png}"><img src="../../static/lib/wysiwyg/smiley/beer.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/beer.png}"><img src="../../static/lib/wysiwyg/smiley/boy.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/boy.png}"><img src="../../static/lib/wysiwyg/smiley/camera.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/camera.png}"><img src="../../static/lib/wysiwyg/smiley/chilli.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/chilli.png}"><img src="../../static/lib/wysiwyg/smiley/cigarette.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/cigarette.png}"><img src="../../static/lib/wysiwyg/smiley/cinema.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/cinema.png}"><img src="../../static/lib/wysiwyg/smiley/coffee.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/coffee.png}"><img src="../../static/lib/wysiwyg/smiley/girl.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/girl.png}"><img src="../../static/lib/wysiwyg/smiley/console.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/console.png}"><img src="../../static/lib/wysiwyg/smiley/grumpy.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/grumpy.png}"><img src="../../static/lib/wysiwyg/smiley/in_love.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/in_love.png}"><img src="../../static/lib/wysiwyg/smiley/internet.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/internet.png}"><img src="../../static/lib/wysiwyg/smiley/lamp.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/lamp.png}"><img src="../../static/lib/wysiwyg/smiley/mobile.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/mobile.png}"><img src="../../static/lib/wysiwyg/smiley/mrgreen.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/mrgreen.png}"><img src="../../static/lib/wysiwyg/smiley/musical-note.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/musical-note.png}"><img src="../../static/lib/wysiwyg/smiley/music.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/music.png}"><img src="../../static/lib/wysiwyg/smiley/phone.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/phone.png}"><img src="../../static/lib/wysiwyg/smiley/plate.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/plate.png}"><img src="../../static/lib/wysiwyg/smiley/restroom.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/restroom.png}"><img src="../../static/lib/wysiwyg/smiley/rose.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/rose.png}"><img src="../../static/lib/wysiwyg/smiley/search.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/search.png}"><img src="../../static/lib/wysiwyg/smiley/shopping.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/shopping.png}"><img src="../../static/lib/wysiwyg/smiley/star.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/star.png}"><img src="../../static/lib/wysiwyg/smiley/studying.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/studying.png}"><img src="../../static/lib/wysiwyg/smiley/suit.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/suit.png}"><img src="../../static/lib/wysiwyg/smiley/surfing.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/surfing.png}"><img src="../../static/lib/wysiwyg/smiley/thunder.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/thunder.png}"><img src="../../static/lib/wysiwyg/smiley/tv.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/tv.png}"><img src="../../static/lib/wysiwyg/smiley/typing.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/typing.png}"><img src="../../static/lib/wysiwyg/smiley/writing.png" width="16" height="16" alt="" th:src="@{/lib/wysiwyg/smiley/writing.png}">
    </div>
    <div th:include="admin/template :: ad-page-common"></div>
    <script type="text/javascript" th:inline="javascript">
    // wysiwyg Editor test
    jQuery(document).ready(function($) {
        var index = 0;
        var element = '#lhjz-textarea-wysiwyg';
        $(element).wysiwyg({
            classes: '',
            // 'selection'|'top'|'top-selection'|'bottom'|'bottom-selection'
            toolbar: index == 0 ? 'top-selection' : (index == 1 ? 'bottom' : 'selection'),
            buttons: {
                smilies: {
                    title: '表情',
                    image: '\uf118',
                    popup: function($popup, $button) {
                        var $smilies = $('<div/>').addClass('wysiwyg-plugin-smilies').attr('unselectable', 'on');

                        $('div.lhjz-editor-smiles img').clone().each(function(index, smiley) {
                            if (index != 0) $smilies.append(' ');
                            var $image = $(smiley).attr('unselectable', 'on');
                            // Append smiley
                            var imagehtml = ' ' + $('<div/>').append($image.clone()).html() + ' ';
                            $image.css({
                                cursor: 'pointer'
                            }).click(function(event) {
                                $(element).wysiwyg('shell').insertHTML(imagehtml); // .closePopup(); - do not close the popup
                            }).appendTo($smilies);
                        });

                        /* $.each(list_smilies, function(index, smiley) {
                            
                         });*/
                        var $container = $(element).wysiwyg('container');
                        $smilies.css({
                            maxWidth: parseInt($container.width() * 0.95) + 'px'
                        });
                        $popup.append($smilies);
                        // Smilies do not close on click, so force the popup-position to cover the toolbar
                        var $toolbar = $button.parents('.wysiwyg-toolbar');
                        if (!$toolbar.length) // selection toolbar?
                            return;
                        return { // this prevents applying default position
                            left: parseInt(($toolbar.outerWidth() - $popup.outerWidth()) / 2),
                            top: $toolbar.hasClass('wysiwyg-plugin-bottom') ? ($container.outerHeight() - parseInt($button.outerHeight() / 4)) : (parseInt($button.outerHeight() / 4) - $popup.height())
                        };
                    },
                    showstatic: true,
                    showselection: true
                },
                insertimage: {
                    title: '插入图片',
                    image: '\uf030',
                    showstatic: true,
                    showselection: true
                },
                insertvideo: {
                    title: '插入视频',
                    image: '\uf03d',
                    showstatic: true,
                    showselection: true
                },
                insertlink: {
                    title: '插入链接',
                    image: '\uf08e'
                },
                fontname: index == 1 ? false : {
                    title: '字体',
                    image: '\uf031',
                    popup: function($popup, $button) {
                        var list_fontnames = {
                            // Name : Font
                            '宋体': '宋体',
                            '黑体': '黑体',
                            '楷体': '楷体',
                            '隶书': '隶书',
                            '幼圆': '幼圆',
                            '微软雅黑': '微软雅黑',
                            'Trebuchet MS': 'Trebuchet MS',
                            'Impact': 'Impact',
                            'Comic Sans MS': 'Comic Sans MS',
                            'Arial, Helvetica': 'Arial,Helvetica',
                            'Verdana': 'Verdana,Geneva',
                            'Georgia': 'Georgia',
                            'Courier New': 'Courier New,Courier',
                            'Times New Roman': 'Times New Roman,Times'
                        };
                        var $list = $('<div/>').addClass('wysiwyg-plugin-list').attr('unselectable', 'on');
                        $.each(list_fontnames, function(name, font) {
                            var $link = $('<a/>').attr('href', '#').css('font-family', font).html(name).click(function(event) {
                                $(element).wysiwyg('shell').fontName(font).closePopup();
                                // prevent link-href-#
                                event.stopPropagation();
                                event.preventDefault();
                                return false;
                            });
                            $list.append($link);
                        });
                        $popup.append($list);
                    },
                    showstatic: true,
                    showselection: true
                },
                fontsize: {
                    title: '字体大小',
                    image: '\uf034',
                    popup: function($popup, $button) {
                        // Hack:
                        // http://stackoverflow.com/questions/5868295/document-execcommand-fontsize-in-pixels/5870603#5870603
                        var list_fontsizes = [];
                        for (var i = 8; i <= 11; ++i) list_fontsizes.push(i + 'px');
                        for (var i = 12; i <= 28; i += 2) list_fontsizes.push(i + 'px');
                        list_fontsizes.push('36px');
                        list_fontsizes.push('48px');
                        list_fontsizes.push('72px');
                        var $list = $('<div/>').addClass('wysiwyg-plugin-list').attr('unselectable', 'on');
                        $.each(list_fontsizes, function(index, size) {
                            var $link = $('<a/>').attr('href', '#').html(size).click(function(event) {
                                $(element).wysiwyg('shell').fontSize(7).closePopup();
                                $(element).wysiwyg('container').find('font[size=7]').removeAttr("size").css("font-size", size);
                                // prevent link-href-#
                                event.stopPropagation();
                                event.preventDefault();
                                return false;
                            });
                            $list.append($link);
                        });
                        $popup.append($list);
                    },
                    showstatic: true,
                    showselection: true
                },
                header: {
                    title: '标题',
                    image: '\uf1dc',
                    popup: function($popup, $button) {
                        var list_headers = {
                            // Name : Font
                            '标题 1': '<h1>',
                            '标题 2': '<h2>',
                            '标题 3': '<h3>',
                            '标题 4': '<h4>',
                            '标题 5': '<h5>',
                            '标题 6': '<h6>',
                            '代码': '<pre>'
                        };
                        var $list = $('<div/>').addClass('wysiwyg-plugin-list').attr('unselectable', 'on');
                        $.each(list_headers, function(name, format) {
                            var $link = $('<a/>').attr('href', '#').css('font-family', format).html(name).click(function(event) {
                                $(element).wysiwyg('shell').format(format).closePopup();
                                // prevent link-href-#
                                event.stopPropagation();
                                event.preventDefault();
                                return false;
                            });
                            $list.append($link);
                        });
                        $popup.append($list);
                    },
                    showstatic: true,
                    showselection: true
                },
                bold: {
                    title: '粗体 (Ctrl+B)',
                    image: '\uf032',
                    hotkey: 'b'
                },
                italic: {
                    title: '斜体 (Ctrl+I)',
                    image: '\uf033',
                    hotkey: 'i'
                },
                underline: {
                    title: '下划线 (Ctrl+U)',
                    image: '\uf0cd',
                    hotkey: 'u'
                },
                strikethrough: {
                    title: '中划线 (Ctrl+S)',
                    image: '\uf0cc',
                    hotkey: 's'
                },
                forecolor: {
                    title: '字体颜色',
                    image: '\uf1fc'
                },
                highlight: {
                    title: '背景色',
                    image: '\uf043'
                },
                alignleft: {
                    title: '左对齐',
                    image: '\uf036',
                    showstatic: true,
                    showselection: true
                },
                aligncenter: {
                    title: '居中对齐',
                    image: '\uf037',
                    showstatic: true,
                    showselection: true
                },
                alignright: {
                    title: '右对齐',
                    image: '\uf038',
                    showstatic: true,
                    showselection: true
                },
                alignjustify: {
                    title: '两端对齐',
                    image: '\uf039',
                    showstatic: true,
                    showselection: true
                },
                subscript: {
                    title: '下标',
                    image: '\uf12c',
                    showstatic: true,
                    showselection: true
                },
                superscript: {
                    title: '上标',
                    image: '\uf12b',
                    showstatic: true,
                    showselection: true
                },
                indent: {
                    title: '增加缩进',
                    image: '\uf03c',
                    showstatic: true,
                    showselection: true
                },
                outdent: {
                    title: '减少缩进',
                    image: '\uf03b',
                    showstatic: true,
                    showselection: true
                },
                orderedList: {
                    title: '有序列表',
                    image: '\uf0cb',
                    showstatic: true,
                    showselection: true
                },
                unorderedList: {
                    title: '无序列表',
                    image: '\uf0ca',
                    showstatic: true,
                    showselection: true
                },
                removeformat: {
                    title: '清除格式',
                    image: '\uf12d'
                }
            },
            submit: {
                title: '提交',
                image: '\uf00c',
                showstatic: true,
                showselection: true
            },
            // Other properties
            selectImage: '单击选择或者拖拽图片',
            placeholderUrl: '',
            placeholderEmbed: '<embed/>',
            maxImageSize: [2000, 2000],
            onKeyDown: function(key, character, shiftKey, altKey, ctrlKey, metaKey) {
                // E.g.: submit form on enter-key:
                //                         if( (key == 10 || key == 13) && !shiftKey && !altKey && !ctrlKey && !metaKey ) {
                //                           //submit_form();
                //                           return false; // swallow enter
                //                         }
            },
            onKeyPress: function(key, character, shiftKey, altKey, ctrlKey, metaKey) {},
            onKeyUp: function(key, character, shiftKey, altKey, ctrlKey, metaKey) {},
            onAutocomplete: function(typed, key, character, shiftKey, altKey, ctrlKey, metaKey) {
                if (typed.indexOf('@') == 0) // startswith '@'
                {
                    var usernames = ['Evelyn', 'Harry', 'Amelia', 'Oliver', 'Isabelle', 'Eddie', 'Editha', 'Jacob', 'Emily', 'George', 'Edison'];
                    var $list = $('<div/>').addClass('wysiwyg-plugin-list').attr('unselectable', 'on');
                    $.each(usernames, function(index, username) {
                        // don't count first character '@'
                        if (username.toLowerCase().indexOf(typed.substring(1).toLowerCase()) !== 0) return;
                        var $link = $('<a/>').attr('href', '#').text(username).click(function(event) {
                            var url = 'http://example.com/user/' + username,
                                html = '<a href="' + url + '">@' + username + '</a> ';
                            var editor = $(element).wysiwyg('shell');
                            // Expand selection and set inject HTML
                            editor.expandSelection(typed.length, 0).insertHTML(html);
                            editor.closePopup().getElement().focus();
                            // prevent link-href-#
                            event.stopPropagation();
                            event.preventDefault();
                            return false;
                        });
                        $list.append($link);
                    });
                    if ($list.children().length) {
                        if (key == 13) {
                            $list.children(':first').click();
                            return false; // swallow enter
                        }
                        // Show popup
                        else if (character || key == 8) return $list;
                    }
                }
            },
            onImageUpload: function(insert_image) {
                var $form = $(this).attr('name', 'file').parents('form').attr('action', $('meta[name="file-upload-url"]').attr('content')).attr('method', 'POST').attr('enctype', 'multipart/form-data');
                $.ajax($form.prop('action'), {
                    data: {
                        /*[+ [[${_csrf.parameterName}]] : [[${_csrf.token}]] +]*/
                    },
                    //dataType: 'json',
                    files: $form.find(':file'),
                    iframe: true,
                    processData: false
                }).always(function() {
                    $form.find(':file').val('');
                }).done(function(resp) {
                    //console.log(JSON.stringify(resp));
                    if (resp.success) {
                        insert_image(resp.data[0].path + resp.data[0].uuidName);
                    } else {
                        // alert error.
                    }
                });
            },
            forceImageUpload: true, // upload images even if File-API is present
            videoFromUrl: function(url) {
                // Contributions are welcome :-)
                // youtube -
                // http://stackoverflow.com/questions/3392993/php-regex-to-get-youtube-video-id
                var youtube_match = url.match(/^(?:http(?:s)?:\/\/)?(?:[a-z0-9.]+\.)?(?:youtu\.be|youtube\.com)\/(?:(?:watch)?\?(?:.*&)?v(?:i)?=|(?:embed|v|vi|user)\/)([^\?&\"'>]+)/);
                if (youtube_match && youtube_match[1].length == 11) return '<iframe src="//www.youtube.com/embed/' + youtube_match[1] + '" width="640" height="360" frameborder="0" allowfullscreen></iframe>';
                // vimeo - http://embedresponsively.com/
                var vimeo_match = url.match(/^(?:http(?:s)?:\/\/)?(?:[a-z0-9.]+\.)?vimeo\.com\/([0-9]+)$/);
                if (vimeo_match) return '<iframe src="//player.vimeo.com/video/' + vimeo_match[1] + '" width="640" height="360" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>';
                // dailymotion - http://embedresponsively.com/
                var dailymotion_match = url.match(/^(?:http(?:s)?:\/\/)?(?:[a-z0-9.]+\.)?dailymotion\.com\/video\/([0-9a-z]+)$/);
                if (dailymotion_match) return '<iframe src="//www.dailymotion.com/embed/video/' + dailymotion_match[1] + '" width="640" height="360" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>';
                // undefined -> create '<video/>' tag
            }
        }).change(function() {
            if (typeof console != 'undefined'); // console.log( 'change' );
        }).focus(function() {
            if (typeof console != 'undefined'); // console.log( 'focus' );
        }).blur(function() {
            if (typeof console != 'undefined'); // console.log( 'blur' );
        });

        $('#btnSave')
            .api({
                action: 'saveArticle',
                method: 'post',
                //stateContext: '.ad-img-cards',
                data: {
                    /*[+ [[${_csrf.parameterName}]] : [[${_csrf.token}]] +]*/
                },
                beforeSend: function(settings) {
                    //settings.urlData = {};
                    $.extend(settings.data, {
                        name: $('#inputFileName').val(),
                        content: $('#lhjz-textarea-wysiwyg').wysiwyg('shell').getHTML()
                    });
                    return settings;
                },
                onSuccess: function(resp, elem) {
                    toastr['success']("保存成功！");
                },
                onFailure: function(resp, elem) {
                    toastr['error'](resp.data, "保存失败！");
                },
                onError: function(errMsg, elem) {
                    toastr['error'](errMsg, "操作失败");
                },
                onAbort: function(errMsg, elem) {
                    toastr['error'](errMsg, "操作失败");
                },
                onComplete: function(resp, elem) {}
            });

    });

    //TODO
    </script>
</body>

</html>
