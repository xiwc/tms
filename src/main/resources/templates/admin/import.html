<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring4-4.dtd">
<html lang="zh-cn" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <base th:href="@{/}" href="">
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <title>TMS-翻译导入</title>
    <link rel="stylesheet" type="text/css" th:href="@{/lib/semantic/semantic.min.css}" href="../../static/lib/semantic/semantic.min.css" />
    <link rel="stylesheet" th:href="@{/lib/toastr/toastr.css}" href="../../static/lib/toastr/toastr.css" />
    <link rel="stylesheet" type="text/css" th:href="@{/admin/css/md-github.css}" href="../../static/admin/css/md-github.css" />
    <link rel="stylesheet" type="text/css" th:href="@{/admin/css/admin.css}" href="../../static/admin/css/admin.css" />
    <script type="text/javascript" th:src="@{/lib/jquery-1.11.1.min.js}" src="../../static/lib/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" th:src="@{/lib/semantic/semantic.min.js}" src="../../static/lib/semantic/semantic.min.js"></script>
    <script type="text/javascript" th:src="@{/lib/jquery.tablesort.min.js}" src="../../static/lib/jquery.tablesort.min.js"></script>
    <script th:src="@{/lib/toastr/toastr.js}" src="../../static/lib/toastr/toastr.js"></script>
    <script type="text/javascript" th:src="@{/lib/showdown.min.js}" src="../../static/lib/showdown.min.js"></script>
    <script type="text/javascript" th:src="@{/admin/js/admin.js}" src="../../static/admin/js/admin.js"></script>
</head>

<body>
    <div th:replace="admin/index :: sidebar-menu"></div>
    <div th:replace="admin/index :: top-fixed-menu"></div>
    <div class="pusher ad-index-content">
        <div class="ad-index-container">
            <div th:replace="admin/index :: rail-menu"></div>
            <div id="context">
                <div th:replace="admin/template :: ad-page-header ('翻译导入', 'import')"></div>
                <div class="ui segment">
                    选择项目:
                    <div class="ui selection dropdown dd-project">
                        <input type="hidden" name="project" th:value="${projectId}" value="1">
                        <i class="dropdown icon"></i>
                        <div class="default text">项目</div>
                        <div class="menu" th:remove="all-but-first">
                            <!--/*/
                            <a th:each="p : ${projects}" class="item" th:href="@{/admin/import(projectId=${p.id})}" th:title="${p.description}" th:attr="data-value=${p.id}" th:text="${p.name}">STEP</a>
                            /*/-->
                            <a class="item" data-value="1">STEP</a>
                            <a class="item" data-value="2">WORK</a>
                            <a class="item" data-value="3">CONSOLE</a>
                        </div>
                    </div>
                    选择语言:
                    <div class="ui selection dropdown dd-language">
                        <input type="hidden" name="language" th:value="${languages[0].id}" value="1">
                        <i class="dropdown icon"></i>
                        <div class="default text">语言</div>
                        <div class="menu" th:remove="all-but-first">
                            <!--/*/
                            <div th:each="l : ${languages}" class="item" th:title="${l.description}" th:attr="data-value=${l.id}" th:text="${l.description + '[' + l.name + ']'}">中文[zh]</div>
                            /*/-->
                            <div class="item" data-value="1">中文[zh]</div>
                            <div class="item" data-value="2">日语[jp]</div>
                            <div class="item" data-value="3">英语[en]</div>
                        </div>
                    </div>
                    <div class="ui primary compact button btn-import">导入</div>
                    <div class="ui form segment">
                        <div class="field">
                            <textarea class="ta-content" name="content" rows="10"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div th:replace="admin/template :: ad-handle-confirm"></div>
    <div th:replace="admin/template :: ad-delete-confirm"></div>
    <div th:replace="admin/template :: ad-translate-add"></div>
    <div th:replace="admin/template :: ad-translate-edit"></div>
    <div th:include="admin/template :: ad-page-common"></div>
    <div th:replace="admin/template :: ad-page-dimmer"></div>
    <script type="text/javascript">
    jQuery(function($) {
        $('table').tablesort().data('tablesort');
        $('.ui.dropdown').dropdown();

        $('.btn-import').click(function(event) {
            var projectId = $('.dd-project').dropdown('get value');
            var languageId = $('.dd-language').dropdown('get value');
            var content = $('.ta-content').val();

            if (content) {
                try {
                    $.parseJSON(content);
                } catch (e) {
                    toastr.error('导入JSON内容格式错误!');
                    return;
                }

                $.post('admin/import/save', {
                    projectId: projectId,
                    languageId: languageId,
                    content: content
                }, function(data, textStatus, xhr) {
                    if (data.success) {
                        toastr.success('导入成功!');
                    } else {
                        toastr.error('导入失败!');
                    }
                });
            }
        });

        $('.tb-translate').on('click', '.ddmi-delete', function(event) {
            var $btn = $(this);

            $('.ad-delete-confirm').modal({
                onApprove: function() {
                    $.post('admin/translate/delete', {
                        id: $btn.closest('tr').attr('data-id')
                    }, function(data, textStatus, xhr) {
                        if (data.success) {
                            $btn.closest('tr').remove();
                            toastr.success('删除成功!');
                        } else {
                            toastr.error('删除失败!');
                        }
                    });
                }
            }).modal('show');
        });

        $('.tb-translate').on('click', '.ddmi-edit', function(event) {
            var $btn = $(this);

            $.get('admin/translate/getById', {
                id: $btn.closest('tr').attr('data-id')
            }, function(data) {
                if (data.success) {
                    $('.ad-translate-edit').modal({
                        onShow: function() {
                            $(this).find('input[name="key"]').val(data.data.key);
                            $(this).find('textarea[name="desc"]').val(data.data.description);
                        },
                        onApprove: function() {
                            var data = Utils.formData('.ad-translate-edit .ui.form');
                            data.id = $btn.closest('tr').attr('data-id');
                            $.post('admin/translate/update2', data, function(data, textStatus, xhr) {
                                if (data.success) {
                                    toastr.success('更新成功!');
                                    window.location.reload();
                                } else {
                                    toastr.error('更新失败!');
                                }
                            });
                        }
                    }).modal('show');
                }
            });

        });

        $('textarea.ta-translteItem').blur(function(event) {
            var $ta = $(this);
            $.post('admin/translate/update', {
                id: $ta.attr('data-id'),
                content: $ta.val()
            }, function(data, textStatus, xhr) {
                if (data.success) {
                    toastr.success('更新成功!');
                } else {
                    toastr.success('更新失败!');
                }
            });
        });

        // $('.table-user').on('click', '.lhjz-btn-edit', function(event) {
        //     var $btn = $(this);

        //     $('.ad-user-edit').find('.user-username').text($btn.closest('tr').attr('data-id'));
        //     $('.ad-user-edit').find('input[name="password"]').val('');

        //     $('.ad-user-edit').modal({
        //         onApprove: function() {
        //             $.post('admin/user/update', {
        //                 username: $btn.closest('tr').attr('data-id'),
        //                 password: $('.ad-user-edit').find('input[name="password"]').val()
        //             }, function(data, textStatus, xhr) {
        //                 if (data.success) {
        //                     $btn.closest('tr').remove();
        //                     toastr.success('用户信息修改成功!');
        //                 } else {
        //                     toastr.error(data.data, '用户信息修改失败!');
        //                 }
        //             });
        //         }
        //     }).modal('show');
        // });
    });
    </script>
</body>

</html>
