<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring4-4.dtd">
<html lang="zh-cn" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <base th:href="@{/}" href="">
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <title>TMS-翻译</title>
    <link rel="stylesheet" type="text/css" th:href="@{/lib/semantic/semantic.min.css}" href="../../static/lib/semantic/semantic.min.css" />
    <link rel="stylesheet" th:href="@{/lib/toastr/toastr.css}" href="../../static/lib/toastr/toastr.css" />
    <link rel="stylesheet" type="text/css" th:href="@{/admin/css/md-github.css}" href="../../static/admin/css/md-github.css" />
    <link rel="stylesheet" type="text/css" th:href="@{/admin/css/admin.css}" href="../../static/admin/css/admin.css" />
    <script type="text/javascript" th:src="@{/lib/jquery-1.11.1.min.js}" src="../../static/lib/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" th:src="@{/lib/semantic/semantic.min.js}" src="../../static/lib/semantic/semantic.min.js"></script>
    <script type="text/javascript" th:src="@{/lib/jquery.tablesort.min.js}" src="../../static/lib/jquery.tablesort.min.js"></script>
    <script th:src="@{/lib/toastr/toastr.js}" src="../../static/lib/toastr/toastr.js"></script>
    <script type="text/javascript" th:src="@{/lib/showdown.min.js}" src="../../static/lib/showdown.min.js"></script>
    <script type="text/javascript" th:src="@{/admin/js/admin.js}" src="../../static/admin/js/admin.js"></script>
</head>

<body>
    <div th:replace="admin/index :: sidebar-menu"></div>
    <div th:replace="admin/index :: top-fixed-menu"></div>
    <div class="pusher ad-index-content">
        <div class="ad-index-container">
            <div th:replace="admin/index :: rail-menu"></div>
            <div id="context">
                <div th:replace="admin/template :: ad-page-header ('翻译', 'translate')"></div>
                <div class="ui segment">
                    <div class="ui selection dropdown dd-project">
                        <input type="hidden" name="project" th:value="${projectId}" value="1">
                        <i class="dropdown icon"></i>
                        <div class="default text">项目</div>
                        <div class="menu" th:remove="all-but-first">
                            <!--/*/
                            <a th:each="p : ${projects}" class="item" th:href="@{/admin/translate(projectId=${p.id})}" th:title="${p.description}" th:attr="data-value=${p.id}" th:text="${p.name}">STEP</a>
                            /*/-->
                            <a class="item" data-value="1">STEP</a>
                            <a class="item" data-value="2">WORK</a>
                            <a class="item" data-value="3">CONSOLE</a>
                        </div>
                    </div>
                    <div class="ui primary compact button btn-add">添加</div>
                </div>
                <div style="max-height: 450px; overflow-y: auto;">
                    <table class="ui sortable celled striped compact table segment table-user">
                        <thead>
                            <th>名称</th>
                            <th>描述</th>
                            <th>翻译</th>
                            <!-- <th th:each="l : ${languages}" th:text="${l.description}">中文</th> -->
                            <th>创建时间</th>
                            <th>状态</th>
                            <th>处理</th>
                        </thead>
                        <tbody th:remove="all-but-first">
                            <!--/*/
                            <tr th:each="t : ${translates}" th:attr="data-id=${t.id}">
                                <td th:text="${t.key}">app.name</td>
                                <td th:text="${t.description}">应用名称</td>
                                <td>
                                    <div class="ui form">
                                        <div class="inline field" th:each="item : ${t.translateItems}" th:attr="data-id=${item.id}">
                                            <label th:text="${item.language.description} + ':'">中文:</label>
                                            <textarea name="zh" th:name="${item.language.name}" rows="1" th:placeholder="${item.language.description}" th:text="${item.content}">测试</textarea>
                                        </div>
                                    </div>
                                </td>
                                <td th:text="${#calendars.format(t.createDate,'yyyy/MM/dd HH:mm:ss')}">2016/05/10 12:00:00</td>
                                <td th:text="${t.status}">待翻译</td>
                                <td>
                                    <div class="ui dropdown">
                                        <div class="text">操作</div>
                                        <i class="dropdown icon"></i>
                                        <div class="menu">
                                            <div class="item">删除</div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            /*/-->
                            <tr>
                                <td>app.name</td>
                                <td>应用名称</td>
                                <td>
                                    <textarea rows="1">测试</textarea>
                                </td>
                                <td>
                                    <textarea rows="1">test</textarea>
                                </td>
                                <td>2016/05/10 12:00:00</td>
                                <td>待翻译</td>
                                <td>
                                    <div class="ui dropdown">
                                        <div class="text">操作</div>
                                        <i class="dropdown icon"></i>
                                        <div class="menu">
                                            <div class="item">删除</div>
                                            <div class="item">
                                                <span class="description">ctrl + o</span> Open...
                                            </div>
                                            <div class="item">
                                                <span class="description">ctrl + s</span> Save as...
                                            </div>
                                            <div class="item">
                                                <span class="description">ctrl + r</span> Rename
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div th:replace="admin/template :: ad-handle-confirm"></div>
    <div th:replace="admin/template :: ad-delete-confirm"></div>
    <div th:replace="admin/template :: ad-translate-add"></div>
    <div th:replace="admin/template :: ad-user-edit"></div>
    <div th:include="admin/template :: ad-page-common"></div>
    <div th:replace="admin/template :: ad-page-dimmer"></div>
    <script type="text/javascript">
    jQuery(function($) {
        $('table').tablesort().data('tablesort');
        $('.ui.checkbox').checkbox();
        $('.ui.dropdown').dropdown();

        $('.btn-add').click(function(event) {

            $('.ad-translate-add').modal({
                onApprove: function() {
                    var data = Utils.formData('.ad-translate-add .ui.form');
                    data.projectId = $('.dd-project').dropdown('get value');
                    data.content = JSON.stringify(data);
                    $.post('admin/translate/save', data,
                        function(data, textStatus, xhr) {
                            if (data.success) {
                                toastr.success('添加成功,刷新当前页面可以查看!');
                            } else {
                                toastr.error(data.data, '添加失败!');
                            }
                        });
                }
            }).modal('show');
        });

        + function() {
            $.get('admin/translate/get', {
                projectId: $('.dd-project').dropdown('get value')
            }, function(data) {
                console.log(data);
            });
        }();

        $('.table-user').on('click', '.lhjz-btn-disable', function(event) {
            var $btn = $(this);

            $('.ad-handle-confirm').modal({
                onApprove: function() {
                    $.post('admin/user/update', {
                        username: $btn.closest('tr').attr('data-id'),
                        enabled: false
                    }, function(data, textStatus, xhr) {
                        if (data.success) {
                            $btn.closest('td').prepend('<div class="ui compact tiny green button lhjz-btn-enable">开启</div>');
                            $btn.closest('tr').find('td.user-status').empty().append('<div class="ui yellow small tag label">停用</div>');
                            $btn.remove();
                            toastr.success('停用操作成功!');
                        } else {
                            toastr.error('停用操作失败!');
                        }
                    });
                }
            }).modal('show');
        });

        $('.table-user').on('click', '.lhjz-btn-enable', function(event) {
            var $btn = $(this);

            $('.ad-handle-confirm').modal({
                onApprove: function() {
                    $.post('admin/user/update', {
                        username: $btn.closest('tr').attr('data-id'),
                        enabled: true
                    }, function(data, textStatus, xhr) {
                        if (data.success) {
                            $btn.closest('td').prepend('<div class="ui compact tiny yellow button lhjz-btn-disable">停用</div>');
                            $btn.closest('tr').find('td.user-status').empty().append('<div class="ui green small tag label">开启</div>')
                            $btn.remove();
                            toastr.success('开启操作成功!');
                        } else {
                            toastr.error('开启操作失败!');
                        }
                    });
                }
            }).modal('show');
        });

        $('.table-user').on('click', '.lhjz-btn-del', function(event) {
            var $btn = $(this);

            $('.ad-delete-confirm').modal({
                onApprove: function() {
                    $.post('admin/user/delete', {
                        username: $btn.closest('tr').attr('data-id')
                    }, function(data, textStatus, xhr) {
                        if (data.success) {
                            $btn.closest('tr').remove();
                            toastr.success('用户删除成功!');
                        } else {
                            toastr.error('用户删除失败!');
                        }
                    });
                }
            }).modal('show');
        });

        $('.table-user').on('click', '.lhjz-btn-edit', function(event) {
            var $btn = $(this);

            $('.ad-user-edit').find('.user-username').text($btn.closest('tr').attr('data-id'));
            $('.ad-user-edit').find('input[name="password"]').val('');

            $('.ad-user-edit').modal({
                onApprove: function() {
                    $.post('admin/user/update', {
                        username: $btn.closest('tr').attr('data-id'),
                        password: $('.ad-user-edit').find('input[name="password"]').val()
                    }, function(data, textStatus, xhr) {
                        if (data.success) {
                            $btn.closest('tr').remove();
                            toastr.success('用户信息修改成功!');
                        } else {
                            toastr.error(data.data, '用户信息修改失败!');
                        }
                    });
                }
            }).modal('show');
        });
    });
    </script>
</body>

</html>
