define("app",["exports","toastr","wurl","common/common-utils","semantic-ui","lodash"],function(e,t,n,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.App=void 0;var o=i(t),u=i(n),a=i(r);e.App=function(){function e(){s(this,e),window.toastr=o.default,window.wurl=u.default,window.utils=a.default,this.init()}return e.prototype.init=function(){_.extend($.fn.form.settings.prompt,{empty:"{name}不能为空",checked:"{name}必须被勾选",email:"{name}必须是正确的邮件格式",url:"{name}必须是正确的URL格式",regExp:"{name}验证格式不正确",integer:"{name}必须为一个整数",decimal:"{name}必须为一个小数",number:"{name}必须设置为一个数字",is:'{name}必须符合规则"{ruleValue}"',isExactly:'{name}必须精确匹配"{ruleValue}"',not:'{name}不能设置为"{ruleValue}"',notExactly:'{name}不能准确设置为"{ruleValue}"',contain:'{name}需要包含"{ruleValue}"',containExactly:'{name}需要精确包含"{ruleValue}"',doesntContain:'{name}不能包含"{ruleValue}"',doesntContainExactly:'{name}不能精确包含"{ruleValue}"',minLength:"{name}必须至少包含{ruleValue}个字符",length:"{name}必须为{ruleValue}个字符",exactLength:"{name}必须为{ruleValue}个字符",maxLength:"{name}必须不能超过{ruleValue}个字符",match:"{name}必须匹配{ruleValue}字段",different:"{name}必须不同于{ruleValue}字段",creditCard:"{name}必须是一个正确的信用卡数字格式",minCount:"{name}必须至少包含{ruleValue}个选择项",exactCount:"{name}必须准确包含{ruleValue}个选择项",maxCount:"{name} 必须有{ruleValue}或者更少个选择项"})},e.prototype.configureRouter=function(e,t){e.map([{route:["pwd-reset"],name:"reset",moduleId:"user/user-pwd-reset",nav:!1,title:"密码重置"},{route:["register"],name:"register",moduleId:"user/user-register",nav:!1,title:"用户注册"},{route:"",redirect:"pwd-reset"}]),this.router=t},e}()}),define("environment",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={debug:!1,testing:!1}}),define("main",["exports","./environment"],function(e,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e){e.use.standardConfiguration().feature("resources"),i.default.debug&&e.use.developmentLogging(),i.default.testing&&e.use.plugin("aurelia-testing"),e.start().then(function(){return e.setRoot()})}Object.defineProperty(e,"__esModule",{value:!0}),e.configure=r;var i=n(t);Promise.config({warnings:{wForgottenReturn:!1}})}),define("common/common-utils",["exports"],function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=e.CommonUtils=function(){function e(){t(this,e)}return e.prototype.getBaseUrl=function(){return"function"==typeof wurl?80==wurl("port")||443==wurl("port")?wurl("protocol")+"://"+wurl("hostname"):wurl("protocol")+"://"+wurl("hostname")+":"+wurl("port"):""},e.prototype.urlQuery=function(e){return wurl("?"+e)||wurl("?"+e,wurl("hash"))},e}();e.default=new n}),define("resources/config",["exports","aurelia-fetch-client","aurelia-framework","toastr","nprogress","isomorphic-fetch"],function(e,t,n,r,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Config=void 0;var u=s(r),a=s(i),l=e.Config=function(){function e(){o(this,e)}return e.prototype.initHttp=function(){return window.json=function(e){return console.log(JSON.stringify(e)),(0,t.json)(e)},window.http=this.aurelia.container.root.get(t.HttpClient),http.configure(function(e){e.withDefaults({credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json","X-Requested-With":"fetch"}}).withInterceptor({request:function(e){return a.default&&a.default.start(),e},requestError:function(e){console.log(e)},response:function(e){return a.default&&a.default.done(),e.ok||(e.json().then(function(e){u.default.error(e.message)}),401!=e.status)?e:void u.default.error("用户未登录!")},responseError:function(e){u.default.error(e.message,"网络请求错误!"),console.log(e)}})}),this},e.prototype.initToastr=function(){u.default.options.positionClass="toast-bottom-center",u.default.options.preventDuplicates=!0},e.prototype.context=function(e){return this.aurelia=e,this},e}();e.default=new l}),define("resources/index",["exports","./config"],function(e,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e){i.default.context(e).initHttp().initToastr()}Object.defineProperty(e,"__esModule",{value:!0}),e.configure=r;var i=n(t)}),define("user/user-pwd-reset",["exports"],function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});e.UserPwdReset=function(){function e(){t(this,e),this.mail="",this.pwd="",this.isReq=!1,this.token=utils.urlQuery("id")}return e.prototype.resetPwdHandler=function(){var e=this;return $(this.fm).form("is valid")?(this.isReq=!0,void http.fetch("/free/user/pwd/reset",{method:"post",body:json({mail:this.mail,baseUrl:utils.getBaseUrl(),path:wurl("path")})}).then(function(t){t.ok&&t.json().then(function(t){t.success?(toastr.success("重置密码邮件链接发送成功!"),_.delay(function(){window.location="/admin/login"},2e3)):(toastr.error(t.data,"重置密码邮件链接发送失败!"),e.isReq=!1)})})):void toastr.error("邮件地址输入不合法!")},e.prototype.newPwdHandler=function(){var e=this;return $(this.fm2).form("is valid")?(this.isReq=!0,void http.fetch("/free/user/pwd/new",{method:"post",body:json({token:this.token,pwd:this.pwd})}).then(function(t){t.ok&&t.json().then(function(t){t.success?(toastr.success("重置密码成功!"),_.delay(function(){window.location="/admin/login"},2e3)):(toastr.error(t.data,"重置密码失败!"),e.isReq=!1)})})):void toastr.error("新密码输入不合法!")},e.prototype.attached=function(){$(this.fm).form({on:"blur",inline:!0,fields:{mail:["empty","email"]}}),$(this.fm2).form({on:"blur",inline:!0,fields:{mail:["empty","minLength[8]"]}})},e}()}),define("user/user-register",["exports"],function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});e.ViewModel=function(){function e(){t(this,e),this.header="账户激活页面"}return e.prototype.activate=function(e,t,n){var r=this;e.id&&(this.token=e.id,this.isReq=!0,this.header="账户激活中,请稍后...!",http.fetch("/free/user/register/activate",{method:"post",body:json({token:this.token})}).then(function(e){e.ok&&(e.json().then(function(e){e.success?r.header="账户激活成功,请返回登录页面登录!":(r.header="账户激活失败!",toastr.error(e.data,"账户激活失败!"))}),r.isReq=!1)}))},e.prototype.attached=function(){$(this.fm).form({on:"blur",inline:!0,fields:{username:{identifier:"username",rules:[{type:"empty"},{type:"minLength[3]"},{type:"regExp",value:/^[a-z]+[a-z0-9\.\-_]*[a-z0-9]+$/,prompt:"小写字母数字.-_组合,字母开头,字母数字结尾"}]},pwd:{identifier:"pwd",rules:[{type:"empty"},{type:"minLength[8]"}]},name:{identifier:"name",rules:[{type:"empty"},{type:"maxLength[20]"}]},mail:{identifier:"mail",rules:[{type:"empty"},{type:"email"}]}}})},e.prototype.okHandler=function(){var e=this;return $(this.fm).form("is valid")?(this.isReq=!0,void http.fetch("/free/user/register",{method:"post",body:json({username:this.username,pwd:this.pwd,name:this.name,mail:this.mail,baseUrl:utils.getBaseUrl(),path:wurl("path")})}).then(function(t){t.ok&&t.json().then(function(t){t.success?(toastr.success("注册成功,请通过接收到的激活邮件激活账户!"),_.delay(function(){window.location="/admin/login"},2e3)):(toastr.error(t.data,"注册失败!"),e.isReq=!1)})})):void toastr.error("账户注册信息输入不合法!")},e}()}),define("text!app.css",["module"],function(e){e.exports='html,\r\nbody {\r\n    height: 100%;\r\n}\r\n\r\n/* .ui.form input:not([type]),\r\n.ui.form input[type="date"],\r\n.ui.form input[type="datetime-local"],\r\n.ui.form input[type="email"],\r\n.ui.form input[type="number"],\r\n.ui.form input[type="password"],\r\n.ui.form input[type="search"],\r\n.ui.form input[type="tel"],\r\n.ui.form input[type="time"],\r\n.ui.form input[type="text"],\r\n.ui.form input[type="file"],\r\n.ui.form input[type="url"] {\r\n\tline-height: normal!important;\r\n} */\r\n'}),define("text!app.html",["module"],function(e){e.exports='<template>\n\t<require from="./app.css"></require>\n\t<require from="nprogress/nprogress.css"></require>\n\t<require from="toastr/build/toastr.css"></require>\n    <!-- <require from="wlzc-semantic-ui/semantic.css"></require> -->\n    <require from="semantic-ui/semantic.css"></require>\n    <router-view></router-view>\n</template>\n'}),define("text!user/user-pwd-reset.css",["module"],function(e){e.exports=".tms-user-pwd-reset {\r\n    height: 100%;\r\n}\r\n\r\n.tms-user-pwd-reset .tms-flex {\r\n    height: 100%;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n}\r\n"}),define("text!user/user-pwd-reset.html",["module"],function(e){e.exports='<template>\r\n    <require from="./user-pwd-reset.css"></require>\r\n    <div class="ui container tms-user-pwd-reset">\r\n        <div class="tms-flex">\r\n            <div if.bind="!token" ref="fm" class="ui form segment" style="width: 260px;">\r\n                <div class="ui message">输入您的邮箱地址,我们会发送密码重置链接到您的邮箱!</div>\r\n                <div class="field">\r\n                    <label style="display:none;">邮件地址</label>\r\n                    <input type="text" name="mail" autofocus="" value.bind="mail" placeholder="输入您的邮件地址">\r\n                </div>\r\n                <div class="ui green fluid button ${isReq ? \'disabled\' : \'\'}" click.delegate="resetPwdHandler()">发送密码重置邮件</div>\r\n            </div>\r\n            <div if.bind="token" ref="fm2" class="ui form segment" style="width: 260px;">\r\n                <div class="ui message">设置您的新密码,密码长度要求至少8位字符!</div>\r\n                <div class="field">\r\n                    <label style="display:none;">新密码</label>\r\n                    <input type="password" name="mail" autofocus="" value.bind="pwd" placeholder="设置您的新密码">\r\n                </div>\r\n                <div class="ui green fluid button ${isReq ? \'disabled\' : \'\'}" click.delegate="newPwdHandler()">确认</div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n'}),define("text!user/user-register.css",["module"],function(e){e.exports=".tms-user-register {\r\n    height: 100%;\r\n}\r\n\r\n.tms-user-register .tms-flex {\r\n    height: 100%;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n}\r\n"}),define("text!user/user-register.html",["module"],function(e){e.exports='<template>\r\n    <require from="./user-register.css"></require>\r\n    <div class="ui container tms-user-register">\r\n        <div class="tms-flex">\r\n            <div if.bind="!token" ref="fm" class="ui form segment" style="width: 280px;">\r\n                <div class="ui message">提交账户注册信息成功后,我们会向您的注册邮箱发送一封账户激活邮件,激活账户后即可登录!</div>\r\n                <div class="required field">\r\n                    <label>用户名</label>\r\n                    <input type="text" name="username" autofocus="" value.bind="username" placeholder="输入您的登录用户名">\r\n                </div>\r\n                <div class="required field">\r\n                    <label>密码</label>\r\n                    <input type="password" name="pwd" autofocus="" value.bind="pwd" placeholder="输入您的登录密码">\r\n                </div>\r\n                <div class="required field">\r\n                    <label>姓名</label>\r\n                    <input type="text" name="name" autofocus="" value.bind="name" placeholder="输入您的显示名称">\r\n                </div>\r\n                <div class="required field">\r\n                    <label>邮箱</label>\r\n                    <input type="text" name="mail" autofocus="" value.bind="mail" placeholder="输入您的账户激活邮箱">\r\n                </div>\r\n                <div class="ui green fluid button ${isReq ? \'disabled\' : \'\'}" click.delegate="okHandler()">确认</div>\r\n            </div>\r\n            <div if.bind="token" class="ui center aligned very padded segment" style="width: 320px;">\r\n            \t<h1 class="ui header">${header}</h1>\r\n            \t<a href="/admin/login" class="ui green button">返回登录页面</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n'});